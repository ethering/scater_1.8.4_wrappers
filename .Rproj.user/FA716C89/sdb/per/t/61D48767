{
    "collab_server" : "",
    "contents" : "#!/usr/bin/env Rscript \n\n# Plot the distribution of read counts and feature counts, side by side, then a scatter plot of read counts vs feature counts below\n# See\n# https://www.rdocumentation.org/packages/scater/versions/1.0.4/topics/calculateQCMetrics\n# for available metrics.\n\n# Load optparse we need to check inputs\n\nsuppressPackageStartupMessages(require(optparse))\n\n# Load common functions\n\nsuppressPackageStartupMessages(require(workflowscriptscommon))\n\n# parse options\n\noption_list = list(\n  make_option(\n    c(\"-i\", \"--input-object-file\"),\n    action = \"store\",\n    default = NA,\n    type = 'character',\n    help = \"A serialized SingleCellExperiment object file in RDS format.\"\n  ),\n  make_option(\n    c(\"-o\", \"--output-plot-file\"),\n    action = \"store\",\n    default = NA,\n    type = 'character',\n    help = \"A jpg file to save plot to, e.g Reads.plot.\"\n  )\n)\n\nopt <- wsc_parse_args(option_list, mandatory = c('input_object_file', 'output_plot_file'))\n\n# Check parameter values\n\nif ( ! file.exists(opt$input_object_file)){\n  stop((paste('File', opt$input_object_file, 'does not exist')))\n}\n\n# Now we're hapy with the arguments, load Scater and do the work\n\nsuppressPackageStartupMessages(require(scater))\n\n# Input from serialized R object\n\nsce <- readRDS(opt$input_object_file)\nprint(paste(\"Starting with\", ncol(sce), \"cells and\", nrow(sce), \"features.\"))\n\n\n#do the scatter plot of reads vs genes\ntotal_counts <- sce$total_counts\ntotal_features <- sce$total_features\ncount_feats <- cbind(total_counts, total_features)\ncf_dm <- as.data.frame(count_feats)\n\nplot <- ggplot(cf_dm, aes(x=total_counts/1e6, y=total_features)) + geom_point(shape=1) + geom_smooth() + xlab(\"Read count (millions)\") + \n   ylab(\"Gene count\") + ggtitle(\"Scatterplot of reads vs genes\")\n\n#calculate binwidths for reads and features plots\nread_bins <- max(total_counts/1e6)/20\nfeat_bins <- max(total_features)/20\n#make the plots\nplot1 <- qplot(total_counts/1e6, geom=\"histogram\", binwidth = read_bins, ylab=\"Number of cells\", xlab = \"Read counts (millions)\", fill=I(\"darkseagreen3\"))\nplot2 <- qplot(total_features, geom=\"histogram\", binwidth = feat_bins, ylab=\"Number of cells\", xlab = \"Feature counts\", fill=I(\"darkseagreen3\"))\nplot3 <- plotColData(sce, y=\"pct_counts_MT\", x=\"total_features_by_counts\") + ggtitle(\"% MT genes\")\n\n#arrange them all together\nlibrary(ggpubr)\n\nfinal_plot <- ggarrange(plot1, plot2, plot, plot3, ncol=2, nrow=2)\nggsave(opt$output_plot_file,final_plot)\n",
    "created" : 1539191542684.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1408488770",
    "id" : "61D48767",
    "lastKnownWriteTime" : 1539192934,
    "last_content_update" : 1539192934103,
    "path" : "~/projects/single_cell/Galaxy/galaxy_tools/RCode/test_scater/scater_modules_1.8.4/scater-plot-dist-scatter.R",
    "project_path" : "scater-plot-dist-scatter.R",
    "properties" : {
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}