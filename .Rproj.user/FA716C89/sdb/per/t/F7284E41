{
    "collab_server" : "",
    "contents" : "source(\"https://bioconductor.org/biocLite.R\")\nbiocLite(\"SingleCellExperiment\")\nbiocLite(\"scater\")\nlibrary(scater)\nlibrary(SingleCellExperiment)\n\noptions(stringsAsFactors=FALSE)\nsetwd(\"/Users/ethering/projects/single_cell/Galaxy/galaxy_tools/RCode/arabidopsis/\")\nsource ('create_SCE.R')\nsource('Plots.R')\nsource ('Filters.R')\nsource(\"Expression.R\")\nsce <- createSCE('../../data/Expression_matrix.txt', '../../data/annotation.txt')\n\n#sce <- createSCE('tepetal_data/new_counts.txt', 'tepetal_data/new_annotations.txt', 'tepetal_data/Mt_Pt_groups.txt')\n\n\n#CELL FILTERING\n#MANUAL FILTERING\n#use only cells with more than 1000 features (genes), less than 20% mtDNA genes and more than 10,000 reads \n\nman_qc_met <- qcMetrics(sce, \"../../data/Mt_Pt_groups.txt\", \"../../data/empty_control_cells.txt\")\nman_qc_met <- remove_unexpressed_genes(man_qc_met)\ndim(man_qc_met)\nplotAll(man_qc_met, \"cell_number\", \"pct_counts_MT\", \"total_features\", \"cell_number\", \"exprs-freq-vs-mean\", \"total_counts\")\n#man_keep <- remove_bad_genes(man_qc_met, 4)\nman_qc_met$use <- manual_cell_filter(man_qc_met, 10000, 1000, 10)\ntable(man_qc_met$use)\ndim(man_qc_met)\n\n\n#table(man_keep$use)\n#dim(man_keep)\n\nman_keep <- man_qc_met[, colData(man_qc_met)$use]\ndim(man_keep)\n\nplotAll(man_keep, \"cell_number\", \"pct_counts_MT\", \"total_features\", \"cell_number\", \"exprs-freq-vs-mean\", \"total_counts\")\n\nplotReadsVsGenes(man_keep)\n\n\n\n#AUTOMATIC FILTERING\nauto_qc <- qcMetrics(sce, \"data/Mt_Pt_groups.txt\", \"data/empty_control_cells.txt\")\n\nauto_qc <- removeOutliers(auto_qc)\n\ntable(auto_qc$use)\ndim(auto_qc)\n\nauto_keep <- auto_qc[, colData(auto_qc)$use]\ndim(auto_keep)\n\nvenn_auto_vs_manual(auto_qc, man_qc_met)\n\n#remove bad genes from auto\nauto_keep <- remove_bad_genes(auto_keep, 4)\ntable(auto_keep$use)\ndim(auto_keep)\n\nauto_keep <- auto_keep[, colData(auto_keep)$use]\ndim(auto_keep)\nvenn_auto_vs_manual(auto_keep, man_qc_met)\n\n\n#GENE FILTERING\n#Remove genes that we suscpect are technical artefacts\n\n#plotTop50(sce)\n\n#FROM MANUALLY FILTERED CELLS\nsource(\"Filter.R\")\nmanual_filtered_genes <- remove_bad_genes(man_qc_met, 5, 2)\ntable(manual_filtered_genes$use)\ndim(manual_filtered_genes)\nman_qc_met <- man_qc_met[rowData(man_qc_met)$use, colData(man_qc_met)$use]\ntable(man_qc_met$use)\ndim(man_qc_met)\n\nplotColData(\n  man_qc_met,\n  y = \"total_features\",\n  x = \"log10_total_counts\"\n  )\n\nplotReadCounts(manual_filtered_genes)\nplotFeatures(manual_filtered_genes)\nplotReadsVsGenes(manual_filtered_genes)\nplotPheno(manual_filtered_genes, \"pct_counts_MT\", \"total_features_by_counts\", \"cell_number\")\ngetPCA(manual_filtered_genes, \"cell_number\")\nqcPlot(manual_filtered_genes, \"exprs-freq-vs-mean\")\nplotPlate(manual_filtered_genes, \"total_counts\")\n\n\n#FROM AUTOMATICALLY FILTERED CELLS\nauto_filtered_genes <- remove_bad_genes(auto_sce, 2)\ntable(auto_filtered_genes$use)\ndim(auto_filtered_genes)\n\n# plotReadCounts(auto_filtered_genes)\n# plotFeatures(auto_filtered_genes)\n# plotReadsVsGenes(auto_filtered_genes)\n# plotPheno(auto_filtered_genes, \"pct_counts_MT\", \"total_features_by_counts\", \"cell_number\")\n# getPCA(auto_filtered_genes, \"cell_number\")\n# qcPlot(auto_filtered_genes, \"exprs-freq-vs-mean\")\n# plotPlate(auto_filtered_genes, \"total_counts\")\n\n\n\n\n# assayNames(sce)\n# endog_genes <- filter_endog_genes(sce)\n# cpm(sce) <- normaliseCPM(sce[endog_genes, ])\n# assayNames(sce)\n#plotAll(filtered_sce, \"cell_number\", \"total_features_endogenous\", \"pct_counts_MT\", \"cell_number\", \"exprs-freq-vs-mean\", \"total_counts\")\n\n\n\n#plotColData(sce, x = \"total_counts\",y = \"pct_counts_feature_control\", colour = \"cell_number\") +\n# theme(legend.position = \"top\") + stat_smooth(method = \"lm\", se = FALSE, size = 2, fullrange = TRUE)\n\n",
    "created" : 1539258342621.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2717253738",
    "id" : "F7284E41",
    "lastKnownWriteTime" : 1538665512,
    "last_content_update" : 1538665512,
    "path" : "~/projects/single_cell/Galaxy/galaxy_tools/RCode/arabidopsis/main.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}